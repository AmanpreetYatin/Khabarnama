package com.bxs.khabarnama.ui.fragments;import android.os.AsyncTask;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.v4.app.Fragment;import android.support.v7.widget.RecyclerView;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.Toast;import com.bxs.khabarnama.R;import com.bxs.khabarnama.ui.Utils.Constants;import com.bxs.khabarnama.ui.Utils.Utilities;import com.bxs.khabarnama.ui.adapters.AudioItemAdapter;import com.bxs.khabarnama.ui.models.AudioModel;import com.bxs.khabarnama.ui.player.PlayerConstants;import java.io.BufferedReader;import java.io.InputStreamReader;import java.net.URL;import java.util.ArrayList;import butterknife.BindView;import butterknife.ButterKnife;/** * this fragment is used from fetch the * jatinder panu show from the folder on server */public class PanuFragment extends Fragment {    public final String TAG = PanuFragment.class.getSimpleName();    private RecyclerView mRecyclerView;    private AudioItemAdapter mAudioItemAdapter;    public static ArrayList<AudioModel> audioModelArrayList = new ArrayList<>(1);    public static PanuFragment newIntance() {        return new PanuFragment();    }    @Nullable    @Override    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {        View view = inflater.inflate(R.layout.fragment_home, container, false);        ButterKnife.bind(view, getActivity());        return view;    }    @Override    public void onViewCreated(View view, @Nullable Bundle savedInstanceState) {        super.onViewCreated(view, savedInstanceState);        mRecyclerView = (RecyclerView) view.findViewById(R.id.recycleview);        new getList().execute();    }    private class getList extends AsyncTask<String, String, String> {        int dpos = 0;        int fpos = 0;        String stName, fName, sturl, tmp;        int stLength = 0;        String d, m;        String mDur, fsize;        @Override        protected String doInBackground(String... params) {            try {                publishProgress("start");                String svrName = "http://dpr.radiokhabarnama.com";                URL url = new URL(Constants.URL_PANU_PROGRAMS); // "http://dpr.radiokhabarnama.com" + "/    home/getlist?odays=10&passkey=7102"                BufferedReader reader = new BufferedReader(new InputStreamReader(url.openStream()));                String str = reader.readLine();                if (str.charAt(0) != '$') {                    publishProgress("err");                    return "bye";                } //return if File not starting with $ , i.e it is not our required file                str = reader.readLine();                PlayerConstants.NEW_SONGS_LIST.clear();                stLength = str.length();                while (stLength > 40) {                    dpos = str.indexOf('$', 1);                    mDur = str.substring(0, dpos);                    dpos++;                    fpos = str.indexOf('$', dpos);                    fsize = str.substring(dpos, fpos);                    dpos = str.indexOf('\\', 6);                    dpos++;                    fpos = str.indexOf('\\', dpos);                    stName = str.substring(dpos, fpos);                    fName = str.substring(fpos + 7, stLength - 4).trim();                    m = Utilities.getMonth(str.substring(fpos + 3, fpos + 5));                    d = str.substring(fpos + 5, fpos + 7);                    tmp = svrName + "/" + str.substring(dpos - 7);                    sturl = tmp.trim();                    tmp = sturl.replace('\\', '/');                    sturl = tmp.replaceAll(" ", "%20");                    PlayerConstants.NEW_SONGS_LIST.add(new AudioModel(fName, stName, sturl, m, d, mDur, fsize)); //add to arraylist title,station name,file url,month,day,file duration in minutes,file size in kb                    str = reader.readLine();                    stLength = str.length();                }                reader.close();            } catch (Exception e) {                publishProgress("err");            }            publishProgress("ok");            return "bye";        }        @Override        protected void onProgressUpdate(String... params) {            if (params[0].equals("start")) {                Toast.makeText(getActivity(), "Fetching...", Toast.LENGTH_SHORT).show();                return;            }            if (params[0].equals("err")) {                Toast.makeText(getActivity(), " Unable to connect Server, please try after few minutes", Toast.LENGTH_SHORT).show();            }//use here ArrayList to populate ListView in android activity        }        @Override        protected void onPostExecute(String s) {            super.onPostExecute(s);            mAudioItemAdapter = new AudioItemAdapter(getActivity(), PlayerConstants.NEW_SONGS_LIST);            mRecyclerView.setAdapter(mAudioItemAdapter);            audioModelArrayList = PlayerConstants.NEW_SONGS_LIST;            mAudioItemAdapter.notifyDataSetChanged();        }    }}